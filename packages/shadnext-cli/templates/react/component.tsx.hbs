import React, { useState, useEffect, useRef } from 'react';
{{#if styled}}
import { Container, Input, CalendarPopup, Header, WeekdayHeader, DayButton } from './{{componentName}}.styles';
{{else}}
import './{{componentName}}.css';
{{/if}}

// Import the web component
import '@shadnext/{{originalName}}';

/**
 * {{componentName}} - A React component version of the {{originalName}} web component
 * 
 * This component was generated using the shadnext CLI.
 * It provides the same functionality as the original web component but with a React API.
 */

interface {{componentName}}Props {
  value?: string;
  onChange?: (date: string) => void;
  placeholder?: string;
  rtl?: boolean;
  primaryColor?: string;
  className?: string;
  [key: string]: any;
}

export const {{componentName}}: React.FC<{{componentName}}Props> = ({
  value,
  onChange,
  placeholder = 'انتخاب تاریخ',
  rtl = true,
  primaryColor = '#3b82f6',
  className = '',
  ...props
}) => {
  // State
  const [isOpen, setIsOpen] = useState<boolean>(false);
  const [selectedDate, setSelectedDate] = useState<string | null>(value || null);
  const elementRef = useRef<HTMLElement>(null);
  const containerRef = useRef<HTMLDivElement>(null);
  
  // Initialize web component
  useEffect(() => {
    const element = elementRef.current;
    if (!element) return;

    // Set initial properties
    if (value) element.setAttribute('date', value);
    if (placeholder) element.setAttribute('placeholder', placeholder);
    element.setAttribute('theme', 'light');
    
    // Add event listener
    const handleDateSelected = (e: Event) => {
      const customEvent = e as CustomEvent;
      setSelectedDate(customEvent.detail);
      if (onChange) onChange(customEvent.detail);
    };

    element.addEventListener('dateSelected', handleDateSelected);

    // Handle outside clicks to close the calendar
    const handleOutsideClick = (e: MouseEvent) => {
      if (containerRef.current && !containerRef.current.contains(e.target as Node)) {
        setIsOpen(false);
      }
    };
    
    document.addEventListener('click', handleOutsideClick);
    
    return () => {
      element.removeEventListener('dateSelected', handleDateSelected);
      document.removeEventListener('click', handleOutsideClick);
    };
  }, [value, placeholder, onChange]);
  
  {{#if styled}}
  return (
    <Container ref={containerRef} rtl={rtl} className={className} {...props}>
      <shadnext-persian-datepicker 
        ref={elementRef as React.RefObject<HTMLElement>}
      />
    </Container>
  );
  {{else}}
  return (
    <div 
      className={`shadnext-{{componentName.toLowerCase()}}-container ${className}`}
      ref={containerRef} 
      style={{ direction: rtl ? 'rtl' : 'ltr' }}
      {...props}
    >
      <shadnext-persian-datepicker 
        ref={elementRef as React.RefObject<HTMLElement>}
      />
    </div>
  );
  {{/if}}
}; 